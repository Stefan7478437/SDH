<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDH</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233B82F6'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        /* Custom styles for the Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="app-root" class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-200 font-inter text-gray-800 antialiased">
    <header class="bg-white shadow-xl py-6 px-4 sm:px-6 lg:px-8 rounded-b-3xl">
        <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between">
            <h1 class="text-5xl font-extrabold text-gray-900 mb-4 sm:mb-0">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-purple-800 drop-shadow-md">
                    SDH
                </span>
            </h1>
            <div class="flex flex-col sm:flex-row items-center gap-4 mt-4 sm:mt-0" id="header-buttons-container">
                </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8" id="main-content-area">
        </main>

    <section class="bg-blue-600 text-white rounded-xl p-8 text-center shadow-lg mt-12">
        <h2 class="text-3xl font-bold mb-4">Can't find what you're looking for?</h2>
        <button id="request-file-button" class="inline-flex items-center justify-center px-8 py-4 border border-white text-base font-medium rounded-xl shadow-sm text-blue-600 bg-white hover:bg-blue-50 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white transition-all duration-300 transform hover:scale-105">
            Request File
        </button>
    </section>

    <footer>
        <div class="max-w-7xl mx-auto text-center text-sm">
            <p>&copy; <span id="current-year"></span> SDH. All rights reserved.</p>
            <p class="mt-2">
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 mx-2">Privacy Policy</a> |
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 mx-2">Terms of Service</a>
            </p>
        </div>
    </footer>
</div>

<script type="module">
    // Define the specific email addresses that grant access
    const ALLOWED_EMAILS = ['admin@sdh.com', 'user@sdh.com'];
    // Define the email address where access requests will be sent
    const REQUEST_RECIPIENT_EMAIL = 'SDH_REQ@mail.com';
    // Define the email address for file requests
    const REQUEST_FILE_EMAIL = 'SDH_SUP@mail.com'; // New constant for file requests

    // Local authentication state
    let isAuthenticated = false;
    let isAdminUser = false; // Flag for admin access
    let isAnonymousUser = false; // Flag for anonymous access
    let userEmail = null; // Store the email if authenticated via specific email

    /**
     * Darkens a given hex color by a specified percentage.
     * @param {string} hex - The hex color string (e.g., "#RRGGBB").
     * @param {number} percent - The percentage to darken (e.g., 10 for 10%).
     * @returns {string} The darkened hex color string.
     */
    function darkenColor(hex, percent) {
        let f = parseInt(hex.slice(1), 16),
            t = percent < 0 ? 0 : 255,
            p = percent < 0 ? percent * -1 : percent,
            R = f >> 16,
            G = (f >> 8) & 0x00ff,
            B = f & 0x0000ff;
        return (
            "#" +
            (
                0x1000000 +
                (Math.round((t - R) * p) + R) * 0x10000 +
                (Math.round((t - G) * p) + G) * 0x100 +
                (Math.round((t - B) * p) + B)
            )
            .toString(16)
            .slice(1)
        );
    }

    /**
     * Generates an SVG icon displaying a file extension.
     * @param {string} extension - The file extension to display (e.g., "PDF", "DOC").
     * @param {string} colorClass - Tailwind CSS class for color (e.g., "text-red-500").
     * @returns {string} The SVG string for the icon.
     */
    function createFileExtensionIcon(extension, colorClass) {
        // Map Tailwind color class to a hex fill color for the SVG background
        let fillColor = '#6B7280'; // Default gray
        switch (colorClass) {
            case 'text-red-500': fillColor = '#EF4444'; break; // Red
            case 'text-yellow-500': fillColor = '#F59E0B'; break; // Yellow
            case 'text-orange-500': fillColor = '#F97316'; break; // Orange
            case 'text-blue-500': fillColor = '#3B82F6'; break; // Blue
            case 'text-green-500': fillColor = '#22C55E'; break; // Green
            case 'text-teal-500': fillColor = '#14B8A6'; break; // Teal
            case 'text-purple-500': fillColor = '#A855F7'; break; // Purple
            case 'text-indigo-500': fillColor = '#6366F1'; break; // Indigo (for Apps)
            case 'text-pink-500': fillColor = '#EC4899'; break; // Pink (for Games)
            default: fillColor = '#6B7280'; // Default gray
        }

        const foldedCornerColor = darkenColor(fillColor, 0.15); // Darken by 15%

        // Adjust font size and vertical position based on extension length
        let fontSize = '8px';
        let yOffset = '15'; // Base Y position for text

        if (extension.length === 3) {
            fontSize = '7.5px';
            yOffset = '14.8';
        } else if (extension.length === 4) {
            fontSize = '6.5px';
            yOffset = '14.5';
        } else if (extension.length >= 5) {
            fontSize = '5.5px';
            yOffset = '14.2';
        }

        // The SVG structure for a file icon with text
        const svgString = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" class="w-12 h-12">
                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7L15 2Z" fill="${fillColor}" filter="url(#shadow)"/>
                    <path d="M14 2v4a2 2 0 0 0 2 2h4L14 2Z" fill="${foldedCornerColor}"/>
                    <text x="12" y="${yOffset}" text-anchor="middle" font-size="${fontSize}" fill="white" font-family="sans-serif" font-weight="500">${extension.toUpperCase()}</text>
                    <defs>
                        <filter id="shadow">
                            <feDropShadow dx="0" dy="1" stdDeviation="1" flood-color="rgba(0,0,0,0.2)"/>
                        </filter>
                    </defs>
                </svg>`;

        console.log(`Generated SVG for ${extension}: fillColor=${fillColor}, foldedCornerColor=${foldedCornerColor}`);
        return svgString;
    }

    // Data for download items
    const downloadItems = [
        // FILES
        {
            id: 43,
            name: 'AmosOS.VMDK',
            description: 'Virtual machine disk image for AmosOS.',
            version: 'VMDK',
            size: '500 MB',
            link: 'https://www.mediafire.com/file/xnpr80v57dgafce/AmogOS-x86_64-1.5.0.vmdk/file',
            category: 'Files',
        },
        {
            id: 44,
            name: 'Asus Eee PC p701 4g drivers',
            description: 'Drivers for Asus Eee PC p701 4g model.',
            version: 'Latest',
            size: '150 MB',
            link: 'https://www.mediafire.com/file/gru8ytwow6e29st/Asus_Eee_PC_p701_4g_surf.rar/file',
            category: 'Files',
        },
        {
            id: 45,
            name: 'LegacyIOSapparchive',
            description: 'Torrent file for a legacy iOS app archive.',
            version: 'Torrent',
            size: '10 GB',
            link: 'https://www.mediafire.com/file/q7xd2j5grfcjdf7/legacyiosapparchive-archive.torrent/file',
            category: 'Files',
        },
        {
            id: 46,
            name: 'PearOS Monterey x64',
            description: 'ISO image for PearOS Monterey x64 operating system.',
            version: 'x64',
            size: '4.5 GB',
            link: 'https://www.mediafire.com/file/5whk0hdpzha9a70/pearOS_Monterey.iso/file',
            category: 'Files',
        },
        {
            id: 47,
            name: 'Tiny 10 x64',
            description: 'Lightweight version of Windows 10 for x64 systems.',
            version: 'x64',
            size: '2.5 GB',
            link: 'https://example.com/downloads/Tiny-10-x64.iso',
            category: 'Files',
        },
        {
            id: 48,
            name: 'Windows 8.1 x64',
            description: 'Installation media for Windows 8.1 x64.',
            version: 'x64',
            size: '3.5 GB',
            link: 'https://example.com/downloads/Windows-8.1-x64.iso',
            category: 'Files',
        },
        {
            id: 49,
            name: 'Windows 7 Ultimate sp1',
            description: 'Service Pack 1 for Windows 7 Ultimate.',
            version: 'SP1',
            size: '3 GB',
            link: 'https://example.com/downloads/Windows-7-Ultimate-sp1.iso',
            category: 'Files',
        },
        {
            id: 50,
            name: 'Windows 95 OSR2',
            description: 'Original Service Release 2 for Windows 95.',
            version: 'OSR2',
            size: '200 MB',
            link: 'https://example.com/downloads/Windows-95-OSR2.iso',
            category: 'Files',
        },
        {
            id: 51,
            name: 'Windows Vista Ultimate x64',
            description: 'Installation media for Windows Vista Ultimate x64.',
            version: 'x64',
            size: '4 GB',
            link: 'https://example.com/downloads/Windows-Vista-Ultimate-x64.iso',
            category: 'Files',
        },
        {
            id: 52,
            name: 'Windows 10 x64',
            description: 'Installation media for Windows 10 x64.',
            version: 'x64',
            size: '5 GB',
            link: 'https://example.com/downloads/Windows-10-x64.iso',
            category: 'Files',
        },
        {
            id: 53,
            name: 'Windows ME',
            description: 'Installation media for Windows Millennium Edition.',
            version: 'ME',
            size: '300 MB',
            link: 'https://example.com/downloads/Windows-ME.iso',
            category: 'Files',
        },
        {
            id: 54,
            name: 'Windows XP',
            description: 'Installation media for Windows XP.',
            version: 'XP',
            size: '600 MB',
            link: 'https://example.com/downloads/Windows-XP.iso',
            category: 'Files',
        },
        {
            id: 55,
            name: 'Windows Vista SP2 All Versions x86',
            description: 'Service Pack 2 for all x86 versions of Windows Vista.',
            version: 'SP2 x86',
            size: '800 MB',
            link: 'https://example.com/downloads/Windows-Vista-SP2-All-Versions-x86.iso',
            category: 'Files',
        },
        {
            id: 56,
            name: 'Dell OEM Windows Vista HomePremium Build 6000 (sp0) x86',
            description: 'Dell OEM version of Windows Vista HomePremium.',
            version: 'Build 6000 (SP0) x82',
            size: '3.8 GB',
            link: 'https://example.com/downloads/Dell-OEM-Windows-Vista-HomePremium-Build-6000-x86.iso',
            category: 'Files',
        },
        {
            id: 57,
            name: 'Windows Vista Ultimate SP2 X86',
            description: 'Service Pack 2 for Windows Vista Ultimate x86.',
            version: 'SP2 x86',
            size: '4.2 GB',
            link: 'https://example.com/downloads/Windows-Vista-Ultimate-SP2-X86.iso',
            category: 'Files',
        },
        {
            id: 58,
            name: 'Windows XP Professional SP3 x86',
            description: 'Service Pack 3 for Windows XP Professional x86.',
            version: 'SP3 x86',
            size: '700 MB',
            link: 'https://example.com/downloads/Windows-XP-Professional-SP3-x86.iso',
            category: 'Files',
        },
        {
            id: 59,
            name: 'Interlop Tools (all)',
            description: 'A collection of Interlop Tools.',
            version: 'All',
            size: '50 MB',
            link: 'https://example.com/downloads/Interlop-Tools-all.zip',
            category: 'Files',
        },
        {
            id: 60,
            name: 'Microsoft App Installer',
            description: 'Installer for Microsoft applications.',
            version: 'Latest',
            size: '10 MB',
            link: 'https://example.com/downloads/Microsoft-App-Installer.exe',
            category: 'Files',
        },
        {
            id: 61,
            name: 'Continuum Cabs',
            description: 'Continuum CAB files for Windows devices.',
            version: 'Latest',
            size: '200 MB',
            link: 'https://example.com/downloads/Continuum-Cabs.zip',
            category: 'Files',
        },
        {
            id: 62,
            name: 'Iutools',
            description: 'Utility tools for various purposes.',
            version: 'Latest',
            size: '5 MB',
            link: 'https://example.com/downloads/Iutools.zip',
            category: 'Files',
        },
        {
            id: 63,
            name: 'Microsoft Lumia Default Ringtone',
            description: 'Default ringtone from Microsoft Lumia phones.',
            version: 'MP3',
            size: '1 MB',
            link: 'https://example.com/downloads/Microsoft-Lumia-Default-Ringtone.mp3',
            category: 'Files',
        },
        {
            id: 64,
            name: 'WSA_2407.40000.0.0_x64_Release-Nightly-GApps-13.0-NoAmazon',
            description: 'Windows Subsystem for Android (WSA) package with GApps.',
            version: '2407.40000.0.0',
            size: '1.2 GB',
            link: 'https://www.mediafire.com/file/r0v4h1mh15wz40u/WSA_2407.40000.0.0_x64_Release-Nightly-GApps-13.0-NoAmazon.rar/file', // Updated link
            category: 'Files',
        },
        // APPS
        {
            id: 30,
            name: 'Windows Device Recovery Tool installer',
            description: 'Official tool to recover and reset your Windows device.',
            version: 'Latest',
            size: '50 MB',
            link: 'https://www.mediafire.com/file/p1ntrhacznnzruu/WindowsDeviceRecoveryToolInstaller%25282%2529.exe/file',
            category: 'Apps',
        },
        {
            id: 31,
            name: 'WPinternals',
            description: 'Advanced tool for Windows Phone customization and unlocking.',
            version: 'Latest',
            size: '30 MB',
            link: 'https://www.mediafire.com/file/pegzjbhdz161ula/WPinternals_2.8.zip/file',
            category: 'Apps',
        },
        {
            id: 32,
            name: 'OTCupdater',
            description: 'Utility for updating Over-the-Cable devices.',
            version: 'Latest',
            size: '10 MB',
            link: 'https://www.mediafire.com/file/ovmuvd848qxjnwy/otcupdater.zip/file',
            category: 'Apps',
        },
        {
            id: 33,
            name: 'Adobe Gen-P',
            description: 'A patcher for Adobe products.',
            version: '2.7',
            size: '5 MB',
            link: 'https://example.com/downloads/Adobe-Gen-P.zip',
            category: 'Apps',
        },
        {
            id: 34,
            name: 'Cinebench R23',
            description: 'Industry-standard benchmark for CPU performance.',
            version: 'R23',
            size: '300 MB',
            link: 'https://example.com/downloads/Cinebench-R23.zip', // Reverted link
            category: 'Apps',
        },
        {
            id: 35,
            name: 'Microsoft Office Professional Plus 2010',
            description: 'Comprehensive suite of productivity applications from Microsoft.',
            version: '2010',
            size: '1.5 GB',
            link: 'https://www.mediafire.com/file/wtkrrrx41nw9czb/SW_DVD5_Office_Professional_Plus_2010w_SP1_64Bit_English_CORE_MLF_X17-76756.ISO/file',
            category: 'Apps',
        },
        {
            id: 36,
            name: 'WPV XAP Deployer 2.0',
            description: 'Tool for deploying XAP files to Windows Phone devices.',
            version: '2.0',
            size: '2 MB',
            link: 'https://example.com/downloads/WPV-XAP-Deployer-2.0.zip',
            category: 'Apps',
        },
        {
            id: 37,
            name: 'Adobe Photoshop 2023',
            description: 'The industry-standard image editing software.',
            version: '2023',
            size: '3 GB',
            link: 'https://example.com/downloads/Adobe-Photoshop-2023.zip',
            category: 'Apps',
        },
        {
            id: 38,
            name: 'Microsoft Office Professional Plus 2007',
            description: 'Older version of Microsoft Office suite for productivity.',
            version: '2007',
            size: '800 MB',
            link: 'https://example.com/downloads/Microsoft-Office-Professional-Plus-2007.iso',
            category: 'Apps',
        },
        {
            id: 39,
            name: 'WinFast PVR2',
            description: 'Software for TV tuner cards, enabling TV viewing and recording.',
            version: 'Latest',
            size: '100 MB',
            link: 'https://www.mediafire.com/file/k67auoggsks4593/WinFast_PVR2.rar/file', // Updated link
            category: 'Apps',
        },
        {
            id: 40,
            name: 'BS.Player PRO',
            description: 'A versatile media player with advanced features.',
            version: '2.77.1092',
            size: '20 MB',
            link: 'https://www.mediafire.com/file/ter3b1x2adkse58/BS.Player_PRO_2.77.1092.rar/file', // Updated link
            category: 'Apps',
        },
        {
            id: 41,
            name: 'Movavi Video Converter',
            description: 'Powerful video converter for various formats.',
            version: '22.4.0',
            size: '60 MB',
            link: 'https://www.mediafire.com/file/ypkvosarq80uxjl/Movavi_Video_Converter_22.4.0_Premium_RePack_%2528%2526_Portable%2529_by_TryRooM.rar/file', // Updated link
            category: 'Apps',
        },
        {
            id: 42,
            name: 'Lossless Scaling',
            description: 'Utility for upscaling games and applications with minimal quality loss.',
            version: '2.9.0',
            size: '15 MB',
            link: 'https://www.mediafire.com/file/o6qf8kuvx1gxhie/Lossless.Scaling.v2.9.0.rar/file', // Updated link
            category: 'Apps',
        },
        // GAMES
        {
            id: 9,
            name: 'The Long Drive',
            description: 'A challenging and atmospheric driving survival game.',
            version: 'Latest',
            size: '500 MB',
            link: 'https://www.mediafire.com/file/z9e5yp6fu5ixon2/The-Long-Drive.rar/file',
            category: 'Games',
        },
        {
            id: 10,
            name: 'Super WorldBox',
            description: 'A god simulation game where you can create and destroy worlds.',
            version: '0.13.9',
            size: '120 MB',
            link: 'https://www.mediafire.com/file/trrnehgvjp47mvr/WorldBox.v0.13.9.rar/file',
            category: 'Games',
        },
        {
            id: 11,
            name: 'Beholder',
            description: 'A dystopian simulation game where you act as a state-installed landlord.',
            version: '1.7.58',
            size: '2.5 GB',
            link: 'https://example.com/downloads/Beholder.zip',
            category: 'Games',
        },
        {
            id: 12,
            name: 'Claybook',
            description: 'An imaginative puzzle platformer where you shape clay-like materials.',
            version: '1.2.0',
            size: '1.1 GB',
            link: 'https://example.com/downloads/Claybook.zip',
            category: 'Games',
        },
        {
            id: 13,
            name: 'GTA III',
            description: 'The iconic open-world action-adventure game set in Liberty City.',
            version: 'Classic',
            size: '700 MB',
            link: 'https://example.com/downloads/GTA-III.zip',
            category: 'Games',
        },
        {
            id: 14,
            name: 'GTA IV',
            description: 'Explore the gritty underworld of Liberty City as Niko Bellic.',
            version: 'Complete',
            size: '16 GB',
            link: 'https://example.com/downloads/GTA-IV.zip',
            category: 'Games',
        },
        {
            id: 15,
            name: 'GTA Romania II',
            description: 'A fan-made modification for the Grand Theft Auto series.',
            version: '2.0',
            size: '900 MB',
            link: 'https://example.com/downloads/GTA-Romania-II.zip',
            category: 'Games',
        },
        {
            id: 16,
            name: 'Motor Town',
            description: 'A realistic driving and trucking simulator.',
            version: '0.6.4',
            size: '3 GB',
            link: 'https://example.com/downloads/Motor-Town.zip',
            category: 'Games',
        },
        {
            id: 17,
            name: 'Papers, Please!',
            description: 'An award-winning indie puzzle game about a border immigration inspector.',
            version: '1.4.11.124',
            size: '80 MB',
            link: 'https://example.com/downloads/Papers-Please.zip',
            category: 'Games',
        },
        {
            id: 18,
            name: 'Please Donâ€™t Touch Anything',
            description: 'A cryptic puzzle game where curiosity can have dire consequences.',
            version: '1.6.6.6',
            size: '150 MB',
            link: 'https://example.com/downloads/Please-Dont-Touch-Anything.zip',
            category: 'Games',
        },
        {
            id: 19,
            name: 'GTA SA',
            description: 'Grand Theft Auto: San Andreas, a classic open-world adventure.',
            version: 'Ultimate',
            size: '4.7 GB',
            link: 'https://example.com/downloads/GTA-SA.zip',
            category: 'Games',
        },
        {
            id: 20,
            name: 'The Astroneer',
            description: 'Explore and reshape distant worlds in this space adventure game.',
            version: 'Latest',
            size: '5 GB',
            link: 'https://example.com/downloads/The-Astroneer.zip',
            category: 'Games',
        },
        {
            id: 21,
            name: 'A Little to the Left',
            description: 'A charming puzzle game about organizing household items.',
            version: '1.0',
            size: '400 MB',
            link: 'https://example.com/downloads/A-Little-to-the-Left.zip',
            category: 'Games',
        },
        {
            id: 22,
            name: 'Bus Simulator 18',
            description: 'Experience the daily life of a bus driver in a large, freely-explorable urban area.',
            version: '2018',
            size: '6.5 GB',
            link: 'https://example.com/downloads/Bus-Simulator-18.zip',
            category: 'Games',
        },
        {
            id: 23,
            name: 'NFS Most Wanted 2012',
            description: 'Outrun cops and rivals to become the most wanted racer.',
            version: '2012',
            size: '6 GB',
            link: 'https://example.com/downloads/NFS-Most-Wanted-2012.zip',
            category: 'Games',
        },
        {
            id: 24,
            name: 'Brick Rigs',
            description: 'Build and drive your own creations from bricks.',
            version: 'Latest',
            size: '2 GB',
            link: 'https://example.com/downloads/Brick-Rigs.zip',
            category: 'Games',
        },
        {
            id: 25,
            name: 'Bus Driver Simulator',
            description: 'Drive buses in various cities and complete routes.',
            version: 'Latest',
            size: '4 GB',
            link: 'https://example.com/downloads/Bus-Driver-Simulator.zip',
            category: 'Games',
        },
        {
            id: 26,
            name: 'Stray',
            description: 'Play as a lost cat in a cyberpunk city filled with robots.',
            version: '1.0',
            size: '8 GB',
            link: 'https://example.com/downloads/Stray.zip',
            category: 'Games',
        },
        {
            id: 27,
            name: 'Teardown',
            description: 'Plan and execute the perfect heist in a fully destructible voxel world.',
            version: 'Latest',
            size: '4 GB',
            link: 'https://example.com/downloads/Teardown.zip',
            category: 'Games',
        },
        {
            id: 28,
            name: 'Zuma Deluxe',
            description: 'A classic marble-matching puzzle game.',
            version: '1.0',
            size: '15 MB',
            link: 'https://www.mediafire.com/file/733zs7umv0yggem/Zuma.Deluxe.zip/file', // Updated link
            category: 'Games',
        },
        {
            id: 29,
            name: 'Zuma Revenge',
            description: 'The sequel to the popular Zuma Deluxe, with new challenges.',
            version: '1.0',
            size: '50 MB',
            link: 'https://www.mediafire.com/file/qqjt5v9utok2jbd/Zumas.Revenge.zip/file', // Updated link
            category: 'Games',
        },
    ];

    // Dynamically generate icons based on file extension
    downloadItems.forEach(item => {
        const url = new URL(item.link);
        const pathSegments = url.pathname.split('/');
        const filename = pathSegments[pathSegments.length - 1];
        const parts = filename.split('.');
        let extension = '';
        if (parts.length > 1) {
            extension = parts[parts.length - 1];
        }

        // Special handling for torrent files where the extension might be at the end of the filename
        if (extension === 'file' && filename.includes('.torrent')) {
            extension = 'torrent';
        }

        // Determine color class based on extension for consistency
        let colorClass = 'text-gray-500';
        switch (extension.toLowerCase()) {
            case 'vmdk':
            case 'iso':
                colorClass = 'text-red-500';
                break;
            case 'rar':
            case 'zip':
                colorClass = 'text-yellow-500';
                break;
            case 'torrent':
                colorClass = 'text-orange-500';
                break;
            case 'exe':
                colorClass = 'text-blue-500';
                break;
            case 'mp3':
                colorClass = 'text-green-500';
                break;
            case 'apk':
                colorClass = 'text-teal-500';
                break;
            case 'cab':
                colorClass = 'text-purple-500';
                break;
            // For apps and games, assign a general color if no specific file extension is relevant
            case 'apps': // This won't be an extension, but for category-based coloring
                colorClass = 'text-indigo-500';
                break;
            case 'games': // This won't be an extension, but for category-based coloring
                colorClass = 'text-pink-500';
                break;
        }

        // If the item is an app or game, and its link doesn't provide a clear extension,
        // use a generic "APP" or "GAME" extension for the icon text
        let displayExtension = extension;
        if (!extension && item.category === 'Apps') {
            displayExtension = 'APP';
            colorClass = 'text-indigo-500'; // Ensure consistent color for generic app icon
        } else if (!extension && item.category === 'Games') {
            displayExtension = 'GAME';
            colorClass = 'text-pink-500'; // Ensure consistent color for generic game icon
        } else if (extension === 'file' && item.link.includes('.torrent')) {
             displayExtension = 'TRNT'; // Shorten for better fit
             colorClass = 'text-orange-500';
        }

        console.log(`Processing item: ${item.name}, Detected Extension: ${extension}, Display Extension: ${displayExtension}, Assigned Color Class: ${colorClass}`);


        item.icon = createFileExtensionIcon(displayExtension, colorClass);
    });


    let activeCategory = 'All';
    let searchQuery = '';

    // Get DOM elements after they are loaded
    const appRoot = document.getElementById('app-root');
    const headerButtonsContainer = document.getElementById('header-buttons-container');
    const mainContentArea = document.getElementById('main-content-area');
    const currentYearSpan = document.getElementById('current-year');

    // Ensure currentYearSpan exists before trying to set its textContent
    if (currentYearSpan) {
        currentYearSpan.textContent = new Date().getFullYear();
    }


    // Function to render the authentication page
    function renderAuthPage() {
        console.log("Rendering auth page");
        mainContentArea.innerHTML = `
            <div class="flex items-center justify-center min-h-[calc(100vh-16rem)]">
                <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Welcome to SDH</h2>
                    <p class="text-gray-600 mb-6">Please enter an allowed email address to access the downloads, or continue anonymously.</p>
                    <div class="space-y-4">
                        <input type="email" id="auth-email" placeholder="Enter Allowed Email Address" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-lg" />
                        <p id="auth-error-message" class="text-red-500 text-sm hidden"></p>
                        <button id="access-button" class="w-full px-6 py-3 text-base font-medium rounded-xl shadow-sm text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:scale-105">
                            Access
                        </button>
                        <button id="anonymous-access-button" class="w-full px-6 py-3 text-base font-medium rounded-xl shadow-sm text-gray-700 bg-gray-100 border border-gray-300 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-300 transform hover:scale-105">
                            Continue Anonymously
                        </button>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Request Access</h3>
                        <button id="show-request-form-button" class="w-full px-6 py-3 text-base font-medium rounded-xl shadow-sm text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-300 transform hover:scale-105">
                            Show Request Form
                        </button>
                        <div id="request-form-container" class="space-y-4 mt-4 hidden">
                            <p class="text-gray-600">Enter your email to send an access request.</p>
                            <input type="email" id="request-email" placeholder="Your Email for Access Request" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200 text-lg" />
                            <p id="request-message" class="text-sm mt-2"></p>
                            <button id="request-access-button" class="w-full px-6 py-3 text-base font-medium rounded-xl shadow-sm text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-300 transform hover:scale-105">
                                Send Access Request
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Attach event listener for the access button
        document.getElementById('access-button').onclick = () => {
            const email = document.getElementById('auth-email').value.toLowerCase();
            const errorMessage = document.getElementById('auth-error-message');

            if (ALLOWED_EMAILS.includes(email)) {
                isAuthenticated = true;
                isAnonymousUser = false;
                userEmail = email;
                isAdminUser = (email === 'admin@sdh.com'); // Set admin flag
                errorMessage.classList.add('hidden');
                renderApp(); // Re-render to show downloads
            } else {
                errorMessage.textContent = "Invalid email address for access. Please try again.";
                errorMessage.classList.remove('hidden');
            }
        };

        document.getElementById('anonymous-access-button').onclick = () => {
            isAuthenticated = true;
            isAnonymousUser = true;
            isAdminUser = false;
            userEmail = null; // No specific email for anonymous users
            renderApp(); // Re-render to show downloads (as anonymous)
        };

        // Attach event listener for the show request form button
        document.getElementById('show-request-form-button').onclick = () => {
            document.getElementById('show-request-form-button').classList.add('hidden');
            document.getElementById('request-form-container').classList.remove('hidden');
            document.getElementById('request-message').textContent = ''; // Clear any previous messages
        };


        // Attach event listener for the request access button
        document.getElementById('request-access-button').onclick = () => {
            const requestEmailInput = document.getElementById('request-email');
            const requestEmail = requestEmailInput.value.toLowerCase();
            const requestMessage = document.getElementById('request-message');

            // Basic email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(requestEmail)) {
                requestMessage.textContent = "Please enter a valid email address.";
                requestMessage.className = "text-red-500 text-sm mt-2";
                return;
            }

            const subject = encodeURIComponent("Access Request for SDH Website");
            const body = encodeURIComponent(`I would like to request access to the SDH website. My email address is: ${requestEmail}\n\nPlease grant me access.`);
            const mailtoLink = `mailto:${REQUEST_RECIPIENT_EMAIL}?subject=${subject}&body=${body}`;

            // Changed to navigate the current window/tab to launch the email client
            window.location.href = mailtoLink;

            requestMessage.textContent = "Your email client should open shortly. This page will navigate away. Please send the pre-filled email to complete your request. You may need to use your browser's back button to return.";
            requestMessage.className = "text-green-600 text-sm mt-2";
            requestEmailInput.value = ''; // Clear the input field
        };
    }

    // Function to render the downloads section
    function renderDownloadsSection() {
        console.log("Rendering downloads section");
        const filteredDownloads = downloadItems.filter(item => {
            const matchesCategory = activeCategory === 'All' || item.category === activeCategory;
            const matchesSearch = searchQuery === '' || item.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                  item.description.toLowerCase().includes(searchQuery.toLowerCase());
            return matchesCategory && matchesSearch;
        });

        const currentSearchInputId = 'search-input'; // Store the ID of the search input
        const currentSearchInputValue = searchQuery; // Store the current value of the search input

        let downloadsHtml = `
            <section class="mb-12">
                <div class="flex flex-col sm:flex-row justify-center sm:justify-between items-center gap-4 mb-10">
                    <div class="flex flex-wrap justify-center sm:justify-start gap-4 order-2 sm:order-1" id="category-buttons-container">
                        </div>

                    <div class="relative w-full sm:w-auto flex-grow sm:flex-grow-0 order-1 sm:order-2 max-w-md">
                        <input
                            type="text"
                            placeholder="Search"
                            class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-lg"
                            id="${currentSearchInputId}"
                            value="${currentSearchInputValue}"
                        />
                        ${searchQuery ? `
                            <button
                                id="clear-search-button"
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        ` : ''}
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-6 h-6"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        `;

        if (filteredDownloads.length > 0) {
            filteredDownloads.forEach(item => {
                downloadsHtml += `
                    <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden flex flex-col">
                        <div class="p-6 flex flex-col items-center text-center">
                            <div class="mb-4">${item.icon}</div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                ${item.name}
                            </h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow">
                                ${item.description}
                            </p>
                            <div class="flex justify-between items-center w-full text-sm text-gray-500 mb-4">
                                <span>Version: ${item.version}</span>
                                <span>Size: ${item.size}</span>
                            </div>
                            <a
                                href="${item.link}"
                                class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl shadow-sm text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:scale-105"
                                download
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                                Download Now
                            </a>
                        </div>
                    </div>
                `;
            });
        } else {
            downloadsHtml += `
                <div class="col-span-full text-center text-gray-600 text-lg py-10">
                    No downloads found in this category or matching your search.
                </div>
            `;
        }

        downloadsHtml += `
                </div>
            </section>
        `;
        mainContentArea.innerHTML = downloadsHtml;

        // Attach event listeners after rendering HTML
        const searchInput = document.getElementById(currentSearchInputId);
        if (searchInput) {
            searchInput.oninput = (e) => {
                searchQuery = e.target.value;
                renderDownloadsSection(); // Only re-render the downloads section
            };
            searchInput.focus(); // Re-focus the input after re-rendering
            // Set cursor to the end of the text
            searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
        }

        const clearSearchButton = document.getElementById('clear-search-button');
        if (clearSearchButton) {
            clearSearchButton.onclick = () => {
                searchQuery = '';
                renderDownloadsSection();
            };
        }

        const categoryButtonsContainer = document.getElementById('category-buttons-container');
        if (categoryButtonsContainer) {
            ['All', 'Apps', 'Games', 'Files'].forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.className = `
                    px-6 py-2 rounded-xl text-lg font-medium transition-all duration-300
                    ${activeCategory === category
                        ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-md'
                        : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-100'
                    }
                `;
                button.onclick = () => {
                    activeCategory = category;
                    searchQuery = ''; // Clear search when changing category
                    renderDownloadsSection(); // Re-render to apply category filter
                };
                categoryButtonsContainer.appendChild(button);
            });
        }
    }

    // Main render function
    function renderApp() {
        console.log("renderApp called. User is authenticated:", isAuthenticated);
        // Clear header buttons always, as they are dynamic based on auth state
        if (headerButtonsContainer) {
            headerButtonsContainer.innerHTML = '';

            // Only add header buttons if the user is authenticated
            if (isAuthenticated) {
                // Add Tutorials button
                const tutorialsButton = document.createElement('button');
                tutorialsButton.textContent = "Tutorials";
                tutorialsButton.className = "px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-colors duration-200 rounded-md";
                tutorialsButton.onclick = () => {
                    // Placeholder for tutorials page navigation
                    console.log("Tutorials button clicked!");
                    // In a real application, you might change the main content or navigate to a new page here.
                };
                headerButtonsContainer.appendChild(tutorialsButton);

                // User Profile and Logout Dropdown
                const userProfileContainer = document.createElement('div');
                // Added 'relative' for dropdown positioning and 'group' for hover effects
                userProfileContainer.className = "relative group ml-4";

                const userInfoButton = document.createElement('button');
                // Increased padding for larger hitbox
                userInfoButton.className = "flex items-center gap-2 px-8 py-4 text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-colors duration-200 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500";
                userInfoButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-500">
                        <circle cx="12" cy="7" r="4"/>
                        <path d="M12 15c-3.5 0-6.5 2-9 6h18c-2.5-4-5.5-6-9-6z"/>
                    </svg>
                    <span class="hidden sm:block">${userEmail || 'Anonymous'}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                `;
                userProfileContainer.appendChild(userInfoButton);

                const dropdownMenu = document.createElement('div');
                // Added transition and transform classes for animation
                dropdownMenu.className = "absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 scale-95 transition-all duration-200 ease-out group-hover:opacity-100 group-hover:scale-100 group-hover:block z-10";
                dropdownMenu.innerHTML = `
                    <button id="logout-button" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 rounded-md">
                        Logout
                    </button>
                `;
                userProfileContainer.appendChild(dropdownMenu);

                // Append the user profile container to the header
                headerButtonsContainer.appendChild(userProfileContainer);

                // Attach event listener for the logout button inside the dropdown
                document.getElementById('logout-button').onclick = () => {
                    isAuthenticated = false;
                    isAdminUser = false;
                    isAnonymousUser = false;
                    userEmail = null;
                    renderApp(); // Re-render to show auth page
                };
            }
        }

        if (isAuthenticated) {
            renderDownloadsSection();
        } else {
            // User is not authenticated, show auth page
            renderAuthPage();
        }
    }

    // Initial render when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOMContentLoaded fired");
        try {
            renderApp();
        } catch (error) {
            console.error("Error during initial app rendering:", error);
            // Optionally display a user-friendly error message on the page
            if (mainContentArea) {
                mainContentArea.innerHTML = `<div class="text-red-600 text-center text-xl mt-10">An error occurred while loading the page. Please try again later. Check the console for more details.</div>`;
            }
        }

        // Attach event listener for the new "Request File" button after initial render
        const requestFileButton = document.getElementById('request-file-button');
        if (requestFileButton) {
            requestFileButton.onclick = () => {
                const subject = encodeURIComponent("File Request from SDH Website");
                const body = encodeURIComponent("I would like to request a specific file. Please provide details about the file you are looking for here:\n\n");
                const mailtoLink = `mailto:${REQUEST_FILE_EMAIL}?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;
            };
        }
    });
</script>
</body>
